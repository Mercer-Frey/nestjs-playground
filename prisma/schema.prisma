generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Movie {
  id String @id @default(uuid(4))

  title       String
  description String?
  releaseYear Int     @map("release_year")
  rating      Float   @default(0.0)
  isAvailable Boolean @default(false) @map("is_available")
  genre       Genre   @default(DRAMA)

  poster   Poster?  @relation(fields: [posterId], references: [id])
  posterId String?  @unique @map("poster_id")
  reviews  Review[] @relation("movie_reviews")
  actors   Actor[]  @relation("movie_actors")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@index([releaseYear, title])
  @@map("movies")
}

model Review {
  id String @id @default(uuid(4))

  text   String
  rating Float  @default(0.0)

  movie   Movie  @relation("movie_reviews", fields: [movieId], references: [id], onDelete: Cascade)
  movieId String @map("movie_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("reviews")
}

model Actor {
  id String @id @default(uuid(4))

  name String

  movies Movie[] @relation("movie_actors")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("actors")
}

model Poster {
  id String @id @default(uuid(4))

  imageUrl String

  movie Movie?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("posters")
}

enum Genre {
  ACTION
  DRAMA
  HORROR
  COMEDY

  @@map("enum_genres")
}

model User {
  id String @id @default(uuid(4))

  email    String @unique
  password String
  name     String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("users")
}

model UserQl {
  id String @id @default(uuid(4))

  email    String     @unique
  password String
  name     String
  role     UserRoleQl @default(GUEST)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("users_ql")
}

enum UserRoleQl {
  GUEST
  ADMIN

  @@map("enum_user_roles")
}

model Message {
  id String @id @default(uuid(4))

  text String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt() @map("updated_at")

  @@map("messages")
}
